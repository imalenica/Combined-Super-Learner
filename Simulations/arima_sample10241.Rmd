---
title: "MIMIC ARIMA Sample 10241"
author: "Rachael Phillips"
date: ""
output:
  pdf_document:
    latex_engine: xelatex
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tinytex)
options(tinytex.verbose = TRUE)
```
```{r, mimic-autoarima-open, echo = FALSE, message = FALSE}
library(here)
library(forecast)
load(here::here("Results", "arima_abpmean.RData"))
load(here::here("Results", "arima_abpsys.RData"))
load(here::here("Results", "arima_abpdias.RData"))
```

We can visualize some of these results and compare the multi-step forecasts to
the one-step forecasts. We should see that the errors from the onestep forecasts
are not as extreme as the multistep forecast errors. This is because we are
continually updating the prediction equation with new data. So we don't
propagate uncertainty from a bad forecast about one time points into the
forecast for the next time point.

```{r, mimic-autoarima-plotfxns, echo = FALSE}
library(ggplot2)
plot_multi <- function(multi_forecast, test_outcome) {
  return(multi_forecast %>%
          autoplot() +
          geom_line(aes(x = as.numeric(time(test_outcome)),
                        y = as.numeric(test_outcome)),
                    col = "black"))
}

plot_all <- function(multi_forecast, onestep_forecast, test_outcome) {            
  return(ggplot() +
        geom_line(aes(x = as.numeric(time(test_outcome)),
                      y = as.numeric(test_outcome)),
                   col = "black") +
        geom_line(aes(x = as.numeric(time(onestep_forecast)),
                      y = as.numeric(onestep_forecast)),
                      col = "red") +
        geom_line(aes(x = as.numeric(time(multi_forecast)),
                      y = as.numeric(multi_forecast)),
                      col = "blue") +              
        scale_color_discrete(name = "Forecasts", labels = c("truth",
                                                           "onestep",
                                                           "multi")))
}
```

# Systolic BP Outcome

The blue surrounding the multi-step forecast represents 95\% and 80\% confidence
intervals.

```{r, echo = FALSE, out.height='65%', out.width='65%', fig.align="center"}
plot_multi(multi_forecast = arima_abpsys$plot_data[[2]]$multi_forecast,
           test_outcome = arima_abpsys$plot_data[[2]]$test)

```

The red line in the plot below corresponds to the one-step forecasts, and the
blue to the multi-step forecasts. The black line is the truth.

```{r, echo = FALSE, out.height='65%', out.width='65%', fig.align="center"}
plot_all(onestep_forecast = arima_abpsys$plot_data[[2]]$onestep_forecast,
         multi_forecast = data.frame(arima_abpsys$plot_data[[2]]$multi_forecast)[,1],
         test_outcome = arima_abpsys$plot_data[[2]]$test)
```

```{r, echo = FALSE, fig.align="center"}
tsdisplay(arima_abpsys$residuals[[2]],
          main = "ARIMA Residuals with Systolic BP Outcome")   
```

\clearpage

# Diastolic BP Outcome

```{r, echo = FALSE, out.height='75%', out.width='75%', fig.align="center"}
plot_multi(multi_forecast = arima_abpdias$plot_data[[2]]$multi_forecast,
           test_outcome = arima_abpdias$plot_data[[2]]$test)
```

```{r, echo = FALSE, out.height='75%', out.width='75%', fig.align="center"}
plot_all(onestep_forecast = arima_abpdias$plot_data[[2]]$onestep_forecast,
         multi_forecast = data.frame(arima_abpdias$plot_data[[2]]$multi_forecast)[,1],
         test_outcome = arima_abpdias$plot_data[[2]]$test)   
```

```{r, echo = FALSE, fig.align="center"}
tsdisplay(arima_abpdias$residuals[[2]],
          main = "ARIMA Residuals with Diastolic BP Outcome")

```

\clearpage

# Mean BP Outcome

```{r, echo = FALSE, out.height='75%', out.width='75%', fig.align="center"}
plot_multi(multi_forecast = arima_abpmean$plot_data[[2]]$multi_forecast,
           test_outcome = arima_abpmean$plot_data[[2]]$test)
```

```{r, echo = FALSE, out.height='75%', out.width='75%', fig.align="center"}
plot_all(onestep_forecast = arima_abpmean$plot_data[[2]]$onestep_forecast,
         multi_forecast = data.frame(arima_abpmean$plot_data[[2]]$multi_forecast)[,1],
         test_outcome = arima_abpmean$plot_data[[2]]$test)
```

```{r, echo = FALSE, fig.align="center"}
tsdisplay(arima_abpmean$residuals[[2]],
          main = "ARIMA Residuals with Mean BP Outcome")      
```
